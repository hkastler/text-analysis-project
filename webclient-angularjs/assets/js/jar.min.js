!function(){"use strict";angular.module("twitterSAApp",["ngTouch","ngRoute","ngResource","ui.bootstrap"]).config(function($routeProvider,$compileProvider,$logProvider,$httpProvider){$compileProvider.debugInfoEnabled(!0),$logProvider.debugEnabled(!0),$httpProvider.interceptors.push("anInterceptor"),$routeProvider.when("/",{templateUrl:"views/main.html",controller:"mainCtrl"}).when("/twittersa/:queryTerm/:tweetCount",{templateUrl:"views/main.html",controller:"mainCtrl"}).when("/about",{templateUrl:"views/about.html",caseInsensitiveMatch:!0})})}(),function(){"use strict";angular.module("twitterSAApp").controller("AlertCtrl",function($log,$scope){$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.$on("error",function(){$scope.alerts=[{type:"danger",msg:"There was a problem in the server!"}]}),$scope.$on("success",function(){$scope.alerts=[{type:"success",msg:"Operation is success!"}]}),$scope.$on("created",function(){$scope.alerts=[{type:"success",msg:"Data is has been saved!"}]})})}(),function(){"use strict";angular.module("twitterSAApp").controller("mainCtrl",function($log,$scope,TwitterSAService){function tabulateDsv(dsvdata,delimiter,target){var data=d3.dsvFormat(delimiter).parse(dsvdata),cols=d3.keys(data[0]),container=d3.select(target);container.html("");var table=container.append("table").attr("class","table table-striped"),sortAscending=(table.append("caption").text("Tweets"),!0),thead=table.append("thead").append("tr"),headers=thead.selectAll("th").data(cols).enter().append("th").text(function(col){return col}).on("click",function(d){headers.attr("class","header"),sortAscending?(rows.sort(function(a,b){return b[d]<a[d]}),sortAscending=!1,this.className="aes"):(rows.sort(function(a,b){return b[d]>a[d]}),sortAscending=!0,this.className="des")});data.shift();var tbody=table.append("tbody"),rows=tbody.selectAll("tr").data(data).enter().append("tr");rows.selectAll("td").data(function(d){return cols.map(function(k){return{value:d[k],name:k}})}).enter().append("td").attr("data-th",function(d){return d.name}).text(function(d){return d.value.replace(/&quot;/g,'"').replace(/&tilde;/g,"~")})}function donutChart(mydata,target){var container=d3.select(target);container.html("");var posPct=mydata.positive/mydata.total*100,negPct=mydata.negative/mydata.total*100,neuPct=mydata.neutral/mydata.total*100,dataset=[{label:"Positive "+Math.round(posPct)+"%",count:mydata.positive},{label:"Negative "+Math.round(negPct)+"%",count:mydata.negative},{label:"Neutral "+Math.round(neuPct)+"%",count:mydata.neutral}],radius=Math.min(360,360)/2,color=d3.scaleOrdinal(d3.schemeCategory10),figure=container.append("figure"),svg=figure.append("svg").attr("width",360).attr("height",360).append("g").attr("transform","translate(180,180)"),arc=d3.arc().innerRadius(radius-75).outerRadius(radius),pie=d3.pie().value(function(d){return d.count}).sort(null),path=svg.selectAll("path").data(pie(dataset)).enter().append("path").attr("d",arc).attr("fill",function(d,i){return color(d.data.label)}),tooltip=container.append("div").attr("class","resultsChartTooltip");tooltip.append("div").attr("class","label"),path.on("mouseover",function(d){tooltip.select(".label").html(d.data.label),tooltip.style("display","block")}),path.on("mouseout",function(){tooltip.style("display","none")});var legend=svg.selectAll(".legend").data(color.domain()).enter().append("g").attr("class","legend").attr("transform",function(d,i){return"translate(-36,"+(22*i-22*color.domain().length/2)+")"});legend.append("rect").attr("width",18).attr("height",18).style("fill",color).style("stroke",color),legend.append("text").attr("x",22).attr("y",14).text(function(d){return d})}$scope.getResults=function(){TwitterSAService.getSAResults($scope.queryTerms,$scope.tweetCount).then(function(response){$scope.resultsTotal=response.data[0],tabulateDsv(response.data[1],"~","#resultsTable"),donutChart($scope.resultsTotal,"#resultsChart")}).catch(function(resp){$scope.resultsTotal=resp,$log.debug(resp)})}})}(),function(){"use strict";angular.module("twitterSAApp").controller("navCtrl",function($scope,$location){$scope.isActive=function(viewLocation){return viewLocation===$location.path()}})}(),function(){"use strict";angular.module("twitterSAApp").directive("anLoader",function($log){return{restrict:"EA",replace:!0,templateUrl:"views/templates/loader.html",link:function(scope,element){function hideElement(){element.css("display","none")}var shownType=element.css("display");scope.$on("loader_show",function(){$log.debug("receive broadcast to show loader"),element.css("display",shownType)}),scope.$on("loader_hide",function(){$log.debug("receive broadcast to hide loader"),hideElement()}),hideElement()}}})}(),function(){"use strict";angular.module("twitterSAApp").directive("navBar",function(){return{templateUrl:"views/templates/navbar.html"}})}(),function(){"use strict";angular.module("twitterSAApp").directive("anSearch",function(){return{restrict:"E",replace:!0,templateUrl:"views/templates/search.html"}})}(),function(){"use strict";angular.module("twitterSAApp").factory("anInterceptor",function($q,$log,$rootScope){var loadings=0;return{request:function(config){return $log.debug("request interceptor"),loadings++,$rootScope.$broadcast("loader_show"),config},response:function(response){return $log.debug("response interceptor"),0==--loadings&&$rootScope.$broadcast("loader_hide"),204===response.status?$rootScope.$broadcast("success"):201===response.status&&$rootScope.$broadcast("created"),response},responseError:function(response){return $log.debug("responseError interceptor"),400===response.status&&$rootScope.$broadcast("error"),0==--loadings&&$rootScope.$broadcast("loader_hide"),$q.reject(response)}}})}(),function(){"use strict";angular.module("twitterSAApp").service("TwitterSAService",["$http",function($http){var port=0==window.location.href.indexOf("https://")?"8443":"8080",serviceLoc="//"+window.location.hostname+":"+port;this.getSAResults=function(queryTerms,tweetCount){return $http.get(serviceLoc+"/text-analysis-service/rest/twittersa/sa/"+queryTerms+"/"+tweetCount)}}])}();